function jsonConverter(a){output={properties:{processor_clock_speed:{valueType:"number"},processor_cache_l2:{valueType:"number"},main_memory_ram_size:{valueType:"number"}},types:{node:{pluralLabel:"nodes"}},items:[]};$.each(a,function(b,d){var c=$.grep(d.links,function(f,e){return f.rel=="self"})[0];splitted_uri=c.href.split("/");d.id=d.uid;d.label=d.uid;d.site=splitted_uri[4];d.cluster=splitted_uri[6];delete d.links;output.items.push(flatten(d,function(e,g,f){switch(g){case"storage_devices_0_size":return(f*GIBI/GIGA/GIGA).toFixed(0);case"main_memory_ram_size":return(f/MEBI);case"processor_clock_speed":return(f/GIGA).toFixed(2);case"processor_cache_l1d":case"processor_cache_l1i":if(f){return(f/KIBI)}else{return f}case"processor_cache_l2":if(f){return(f/KIBI)}else{return f}default:return f}}))});return output}var sites_already_loaded=0;var sites_count=0;var clusters_already_loaded=0;var clusters_count=0;var all_nodes=[];$(document).ready(function(){$.ajax({url:"/2.0/grid5000/sites",dataType:"json",type:"GET",cache:true,ifModified:true,global:false,beforeSend:function(){window.database=Exhibit.Database.create();window.exhibit=Exhibit.create();window.exhibit.configureFromDOM();Exhibit.UI.showBusyIndicator()},error:function(a,c,b){$.jGrowl("Error when trying to get the description of Grid5000.")},success:function(a,b){$.each(a.items,function(d,c){sites_count+=1;var e=$.grep(c.links,function(g,f){return g.title=="clusters"})[0];$.ajax({url:e.href+"?version="+c.version,dataType:"json",type:"GET",cache:true,ifModified:true,global:false,success:function(g,f){$.each(g.items,function(j,h){clusters_count+=1;var k=$.grep(h.links,function(m,l){return m.title=="nodes"})[0];$.ajax({url:k.href+"?version="+h.version,dataType:"json",type:"GET",cache:true,ifModified:true,global:false,success:function(l,i){$.merge(all_nodes,l.items)},complete:function(l,i){clusters_already_loaded+=1;if(sites_already_loaded==sites_count&&clusters_already_loaded==clusters_count){window.database.loadData(jsonConverter(all_nodes));Exhibit.UI.hideBusyIndicator()}}})})},error:function(f,h,g){$.jGrowl("Error when trying to get the description of the "+c.uid+" clusters.")},complete:function(f,g){sites_already_loaded+=1}})})}})});
